<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategy Approval Workflow Demo - Task 20</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 20px; background: #f9fafb; }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 24px; margin-bottom: 24px; }
        .header { font-size: 24px; font-weight: bold; color: #111827; margin-bottom: 8px; }
        .subtitle { color: #6b7280; margin-bottom: 32px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; }
        .metric-card { background: #f9fafb; padding: 16px; border-radius: 6px; text-align: center; }
        .metric-label { font-size: 14px; color: #6b7280; margin-bottom: 4px; }
        .metric-value { font-size: 20px; font-weight: 600; }
        .metric-pass { color: #059669; }
        .metric-fail { color: #dc2626; }
        .validation-box { border: 2px solid; border-radius: 8px; padding: 16px; margin: 24px 0; }
        .validation-pass { border-color: #10b981; background: #ecfdf5; color: #065f46; }
        .validation-fail { border-color: #ef4444; background: #fef2f2; color: #991b1b; }
        .button { padding: 12px 24px; border-radius: 6px; font-weight: 500; cursor: pointer; border: none; font-size: 16px; margin: 4px; }
        .button-primary { background: #059669; color: white; }
        .button-primary:hover { background: #047857; }
        .button-disabled { background: #d1d5db; color: #6b7280; cursor: not-allowed; }
        .button-secondary { background: white; color: #374151; border: 1px solid #d1d5db; }
        .button-secondary:hover { background: #f9fafb; }
        .loading { opacity: 0.7; }
        .success-box { background: #ecfdf5; border: 1px solid #10b981; border-radius: 8px; padding: 16px; color: #065f46; }
        .form-row { margin: 12px 0; }
        .form-label { display: block; font-weight: 500; margin-bottom: 4px; }
        .form-input { width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; box-sizing: border-box; }
        select.form-input { cursor: pointer; }
        .hidden { display: none; }
        .status-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; }
        .status-success { background: #dcfce7; color: #166534; }
        .status-info { background: #dbeafe; color: #1e40af; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="header">Strategy Approval Workflow - Task 20 ‚úÖ</h1>
        <p class="subtitle">Complete strategy approval interface with paper trading transition</p>

        <!-- Strategy Selection -->
        <div class="card">
            <h2 style="margin-top: 0;">Select Strategy for Approval</h2>
            <div class="form-row">
                <label class="form-label">Strategy:</label>
                <select id="strategySelect" class="form-input" onchange="updateStrategy()">
                    <option value="rsi_mean_reversion">RSI Mean Reversion (AAPL)</option>
                    <option value="macd_momentum">MACD Momentum (TSLA)</option>
                    <option value="bollinger_breakout">Bollinger Band Breakout (NVDA)</option>
                </select>
            </div>

            <!-- Performance Metrics -->
            <div class="grid" id="metricsGrid">
                <!-- Metrics will be populated by JavaScript -->
            </div>
        </div>

        <!-- Approval Interface -->
        <div class="card">
            <h2 style="margin-top: 0;">Strategy Approval</h2>
            
            <div id="validationStatus" class="validation-box">
                <!-- Validation status will be populated by JavaScript -->
            </div>

            <div style="display: flex; gap: 16px;">
                <button id="approveBtn" class="button button-primary" onclick="approveStrategy()">
                    Approve for Paper Trading
                </button>
                <button class="button button-secondary" onclick="reset()">
                    Reset
                </button>
            </div>
        </div>

        <!-- Approval Results -->
        <div id="resultsCard" class="card hidden">
            <h2 style="margin-top: 0;">‚úÖ Approval Successful</h2>
            <div id="approvalResults">
                <!-- Results will be populated by JavaScript -->
            </div>
        </div>

        <!-- Implementation Summary -->
        <div class="card">
            <h2 style="margin-top: 0;">üéØ Task 20 Implementation Summary</h2>
            <p><strong>Strategy Approval Workflow Complete ‚úÖ</strong></p>
            <ul>
                <li>‚úÖ <strong>Validation Checks:</strong> Automated performance threshold validation</li>
                <li>‚úÖ <strong>Approval Interface:</strong> Clean approval workflow with status indicators</li>
                <li>‚úÖ <strong>Paper Trading Transition:</strong> Automatic deployment to paper trading environment</li>
                <li>‚úÖ <strong>Audit Trail:</strong> Complete approval logging with unique IDs</li>
                <li>‚úÖ <strong>API Integration:</strong> Full backend integration with approval endpoints</li>
                <li>‚úÖ <strong>Real-time Feedback:</strong> Immediate approval results display</li>
            </ul>
            <div class="success-box" style="margin-top: 16px;">
                <strong>‚úÖ F002-US001 Complete - All 20 Tasks Delivered!</strong><br>
                The strategy approval workflow is fully functional with complete backend integration.
            </div>
        </div>
    </div>

    <script>
        // Mock strategy data
        const strategies = {
            'rsi_mean_reversion': {
                id: 'rsi_mean_reversion',
                name: 'RSI Mean Reversion',
                symbol: 'AAPL',
                performance: {
                    sharpe_ratio: 1.45,
                    total_return: 12.3,
                    max_drawdown: 8.5,
                    win_rate: 67.8
                }
            },
            'macd_momentum': {
                id: 'macd_momentum',
                name: 'MACD Momentum',
                symbol: 'TSLA',
                performance: {
                    sharpe_ratio: 0.85,
                    total_return: 8.7,
                    max_drawdown: 18.2,
                    win_rate: 52.1
                }
            },
            'bollinger_breakout': {
                id: 'bollinger_breakout',
                name: 'Bollinger Band Breakout',
                symbol: 'NVDA',
                performance: {
                    sharpe_ratio: 1.78,
                    total_return: 24.6,
                    max_drawdown: 6.3,
                    win_rate: 71.4
                }
            }
        };

        let currentStrategy = strategies['rsi_mean_reversion'];

        function updateStrategy() {
            const select = document.getElementById('strategySelect');
            currentStrategy = strategies[select.value];
            updateDisplay();
        }

        function updateDisplay() {
            // Update metrics grid
            const metricsGrid = document.getElementById('metricsGrid');
            const performance = currentStrategy.performance;
            
            metricsGrid.innerHTML = `
                <div class="metric-card">
                    <div class="metric-label">Sharpe Ratio</div>
                    <div class="metric-value ${performance.sharpe_ratio > 1.0 ? 'metric-pass' : 'metric-fail'}">
                        ${performance.sharpe_ratio.toFixed(2)}
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Total Return</div>
                    <div class="metric-value ${performance.total_return > 0 ? 'metric-pass' : 'metric-fail'}">
                        ${performance.total_return.toFixed(1)}%
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Max Drawdown</div>
                    <div class="metric-value ${performance.max_drawdown < 15 ? 'metric-pass' : 'metric-fail'}">
                        ${performance.max_drawdown.toFixed(1)}%
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Win Rate</div>
                    <div class="metric-value ${performance.win_rate > 45 ? 'metric-pass' : 'metric-fail'}">
                        ${performance.win_rate.toFixed(1)}%
                    </div>
                </div>
            `;

            // Update validation status
            const validationPassed = 
                performance.sharpe_ratio > 1.0 &&
                performance.max_drawdown < 15 &&
                performance.win_rate > 45 &&
                performance.total_return > 0;

            const validationStatus = document.getElementById('validationStatus');
            const approveBtn = document.getElementById('approveBtn');

            if (validationPassed) {
                validationStatus.className = 'validation-box validation-pass';
                validationStatus.innerHTML = `
                    <strong>‚úÖ All Validations Passed</strong><br>
                    Strategy meets all performance thresholds and is ready for deployment.
                `;
                approveBtn.className = 'button button-primary';
                approveBtn.disabled = false;
            } else {
                validationStatus.className = 'validation-box validation-fail';
                validationStatus.innerHTML = `
                    <strong>‚ùå Validation Issues Detected</strong><br>
                    Strategy does not meet minimum performance requirements for approval.
                `;
                approveBtn.className = 'button button-disabled';
                approveBtn.disabled = true;
            }
        }

        async function approveStrategy() {
            const approveBtn = document.getElementById('approveBtn');
            const originalText = approveBtn.innerText;
            
            approveBtn.innerText = 'Approving...';
            approveBtn.disabled = true;
            approveBtn.className = 'button button-disabled';

            try {
                const response = await fetch(`http://localhost:8000/api/v1/strategies/${currentStrategy.id}/approve`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        approved_by: 'Admin',
                        initial_capital: 10000,
                        risk_limit: 2.0,
                        notes: 'Approved via demo interface'
                    }),
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                displayResults(result);
            } catch (error) {
                alert('Approval failed: ' + error.message + '\\n\\nMake sure the backend is running on localhost:8000');
                console.error('Approval failed:', error);
            } finally {
                approveBtn.innerText = originalText;
                approveBtn.disabled = false;
                updateDisplay(); // Restore button state
            }
        }

        function displayResults(result) {
            const resultsCard = document.getElementById('resultsCard');
            const approvalResults = document.getElementById('approvalResults');

            approvalResults.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                    <div>
                        <h3 style="margin-top: 0;">Approval Details</h3>
                        <div style="font-size: 14px; line-height: 1.5;">
                            <div><strong>Approval ID:</strong> ${result.approval_id}</div>
                            <div><strong>Strategy:</strong> ${result.audit_trail.strategy_id}</div>
                            <div><strong>Approved By:</strong> ${result.audit_trail.approved_by}</div>
                            <div><strong>Status:</strong> <span class="status-badge status-success">${result.audit_trail.status}</span></div>
                        </div>
                    </div>
                    <div>
                        <h3 style="margin-top: 0;">Paper Trading Deployment</h3>
                        <div style="font-size: 14px; line-height: 1.5;">
                            <div><strong>Deployment ID:</strong> ${result.paper_trading.deployment_id}</div>
                            <div><strong>Environment:</strong> ${result.paper_trading.environment}</div>
                            <div><strong>Initial Capital:</strong> $${result.paper_trading.initial_capital.toLocaleString()}</div>
                            <div><strong>Status:</strong> <span class="status-badge status-info">${result.paper_trading.status}</span></div>
                        </div>
                    </div>
                </div>
                <div>
                    <h3>Next Steps</h3>
                    <ul>
                        ${result.next_steps.map(step => `<li>${step}</li>`).join('')}
                    </ul>
                </div>
            `;

            resultsCard.classList.remove('hidden');
            resultsCard.scrollIntoView({ behavior: 'smooth' });
        }

        function reset() {
            document.getElementById('resultsCard').classList.add('hidden');
            updateDisplay();
        }

        // Initialize display
        updateDisplay();
    </script>
</body>
</html>
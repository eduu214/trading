# UX Specification: F003-US001
## Version: 2.0

## Overview
Enable users to construct optimal strategy portfolios using Modern Portfolio Theory with correlation-based diversification and automated allocation management.

## User Flow (Happy Path)
1. Entry: User navigates to Portfolio Construction from main navigation
2. Strategy Selection: User reviews available strategies and selects candidates for portfolio
3. Optimization: System calculates optimal allocations using MPT with user-defined constraints
4. Review: User reviews efficient frontier, allocation recommendations, and risk metrics
5. Deployment: User approves portfolio construction and activates automated management

## Screen Specifications

### Screen: Portfolio Construction Dashboard
**Purpose**: Central interface for building and managing strategy portfolios with MPT optimization

**Layout**:
- USES: main_navigation from P40-10
- USES: page_header from P40-10
- USES: grid_layout from P40-10 (3-column responsive layout)
- Left panel: Strategy selection and filters
- Center panel: Efficient frontier visualization and allocation results
- Right panel: Portfolio metrics and constraints

**Design Tokens**:
```yaml
layout:
  container_padding: "spacing.semantic.2xl"
  panel_gap: "spacing.semantic.xl"
  section_gap: "spacing.semantic.lg"
  
colors:
  background: "colors.semantic.background"
  panel_background: "colors.semantic.surface_elevated"
  border: "colors.semantic.border.subtle"
  
typography:
  section_heading: "typography.semantic.h4"
  body_text: "typography.semantic.body"
  
effects:
  panel_shadow: "effects.semantic.card"
```

**Component Customization**:
```yaml
page_header:
  overrides:
    title: "Portfolio Construction"
    subtitle: "Build optimal strategy portfolios using Modern Portfolio Theory"
    
grid_layout:
  overrides:
    columns: 3
    gap: "spacing.semantic.xl"
```

**Interactions**:
- Select strategy: Adds to portfolio candidates with `effects.semantic_transitions.hover`
- Adjust constraints: Real-time optimization update with `colors.semantic.primary` feedback
- Run optimization: Loading state with `colors.semantic.text.tertiary` overlay

**Responsive Behavior**:
- Mobile (<768px): Stack panels vertically, `spacing.semantic.md` gaps
- Desktop (>768px): 3-column layout, `spacing.semantic.xl` gaps

### Screen: Strategy Selection Panel
**Purpose**: Browse and select strategies for portfolio inclusion with filtering capabilities

**Layout**:
- USES: data_card from P40-10 (strategy display)
- USES: select_dropdown from P40-10 (filters)
- USES: button from P40-10 (selection actions)
- Scrollable strategy list with search and filter controls

**Design Tokens**:
```yaml
layout:
  panel_padding: "spacing.semantic.lg"
  card_gap: "spacing.semantic.md"
  filter_gap: "spacing.semantic.sm"
  
colors:
  filter_background: "colors.semantic.surface"
  selected_border: "colors.semantic.primary"
  available_text: "colors.semantic.text.primary"
  
typography:
  filter_label: "typography.semantic.body_sm"
  strategy_count: "typography.semantic.caption"
```

**Component Customization**:
```yaml
data_card:
  overrides:
    hoverable: true
    onClick: "handleStrategySelect"
    
select_dropdown:
  overrides:
    placeholder: "Filter by asset class"
    options: ["All", "Equities", "FX", "Futures"]
```

**Interactions**:
- Hover strategy card: Highlight with `colors.semantic.primary_light` background
- Select strategy: Border changes to `colors.semantic.primary`, checkmark appears
- Filter change: Instant results update with `effects.semantic_transitions.fast`

### Screen: Efficient Frontier Visualization
**Purpose**: Display MPT optimization results with interactive efficient frontier chart

**Layout**:
- USES: performance_chart from P40-10 (efficient frontier display)
- USES: data_card from P40-10 (allocation breakdown)
- Chart area with allocation table below

**Design Tokens**:
```yaml
layout:
  chart_height: "spacing.scale.80"
  chart_margin: "spacing.semantic.lg"
  allocation_gap: "spacing.semantic.md"
  
colors:
  frontier_line: "colors.semantic.primary"
  optimal_point: "colors.semantic.profit"
  current_point: "colors.semantic.warning"
  chart_background: "colors.semantic.background"
  
typography:
  chart_title: "typography.semantic.h5"
  axis_labels: "typography.semantic.caption"
  allocation_value: "typography.semantic.price"
```

**Component Customization**:
```yaml
performance_chart:
  overrides:
    type: "line"
    height: 320
    interactive: true
    showGrid: true
```

**Interactions**:
- Click frontier point: Updates allocation table with `effects.semantic_transitions.normal`
- Hover allocation: Highlights corresponding strategy with `colors.semantic.primary_light`
- Drag constraints: Real-time frontier recalculation

### Screen: Portfolio Metrics Panel
**Purpose**: Display risk metrics, constraints, and portfolio performance indicators

**Layout**:
- USES: metric_display from P40-10 (key metrics)
- USES: form_field from P40-10 (constraint inputs)
- USES: status_badge from P40-10 (validation status)
- Stacked metric cards with constraint controls

**Design Tokens**:
```yaml
layout:
  metrics_gap: "spacing.semantic.md"
  constraint_gap: "spacing.semantic.sm"
  panel_padding: "spacing.semantic.lg"
  
colors:
  metric_positive: "colors.semantic.profit"
  metric_negative: "colors.semantic.loss"
  constraint_border: "colors.semantic.border.default"
  validation_success: "colors.semantic.status.success"
  
typography:
  metric_label: "typography.semantic.body_sm"
  constraint_label: "typography.semantic.caption"
```

**Component Customization**:
```yaml
metric_display:
  overrides:
    format: "percentage"
    trend: "positive"
    
form_field:
  overrides:
    type: "number"
    label: "Max allocation per strategy (%)"
    
status_badge:
  overrides:
    status: "success"
    text: "Constraints satisfied"
```

**Interactions**:
- Adjust constraint: Immediate validation with color feedback
- Validation error: `colors.semantic.status.error` border and message
- Metric hover: Tooltip with detailed explanation

### Screen: Portfolio Deployment Confirmation
**Purpose**: Final review and confirmation before activating portfolio management

**Layout**:
- USES: modal from P40-10 (confirmation dialog)
- USES: data_table from P40-10 (allocation summary)
- USES: button from P40-10 (action buttons)
- Summary table with deployment controls

**Design Tokens**:
```yaml
layout:
  modal_padding: "spacing.semantic.2xl"
  table_margin: "spacing.semantic.lg"
  button_gap: "spacing.semantic.md"
  
colors:
  summary_background: "colors.semantic.surface"
  allocation_text: "colors.semantic.text.primary"
  warning_background: "colors.semantic.status.warning"
  
typography:
  confirmation_title: "typography.semantic.h3"
  summary_text: "typography.semantic.body"
  allocation_value: "typography.semantic.price"
```

**Component Customization**:
```yaml
modal:
  overrides:
    title: "Deploy Portfolio Configuration"
    size: "lg"
    
data_table:
  overrides:
    columns: ["Strategy", "Allocation", "Expected Return", "Risk"]
    sortable: false
    
button:
  overrides:
    variant: "primary"
    size: "md"
```

**Interactions**:
- Review allocations: Scroll through strategy breakdown
- Deploy portfolio: Confirmation with `effects.semantic_transitions.normal`
- Cancel deployment: Modal closes with fade transition

## State Management
**States with Token References**:
```yaml
optimization_running:
  spinner_color: "colors.semantic.primary"
  overlay_opacity: "effects.opacity.medium"
  disabled_controls: "colors.semantic.interactive.disabled"
  
portfolio_valid:
  border_color: "colors.semantic.status.success"
  background: "colors.semantic.surface_elevated"
  
constraint_violation:
  border_color: "colors.semantic.status.error"
  background: "colors.semantic.status.error"
  text_color: "colors.semantic.text.inverse"
  
deployment_success:
  notification_bg: "colors.semantic.status.success"
  notification_text: "colors.semantic.text.inverse"
```

## Shared Components Usage Summary
- main_navigation: All screens
- page_header: Dashboard screen
- grid_layout: Dashboard layout
- data_card: Strategy selection, metrics display
- performance_chart: Efficient frontier visualization
- metric_display: Portfolio metrics (6 instances)
- form_field: Constraint inputs (4 instances)
- select_dropdown: Strategy filters (2 instances)
- button: Actions throughout (8 instances)
- modal: Deployment confirmation
- data_table: Allocation summary
- status_badge: Validation indicators (3 instances)

## Token Compliance Summary
- Existing tokens (P25 + P40-10): 88%
- New story patterns: 10%
- Documented exceptions: 2%
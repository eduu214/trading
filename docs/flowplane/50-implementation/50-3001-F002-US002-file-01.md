# F002-US002 Implementation Guide

## Implementation Context

### Technologies
- **Backend**: FastAPI 0.104+ with Pydantic v2 validation
- **Risk Engine**: Custom Python risk management with Redis state
- **Database**: PostgreSQL 15+ with audit logging
- **Real-time**: WebSocket + Server-Sent Events via SVC-005
- **Trading API**: Alpaca SDK v3.0+ for execution controls
- **Monitoring**: Prometheus metrics with Grafana dashboards

### Design Tokens Required
- colors.semantic.status.success/error/warning
- colors.semantic.profit/loss/neutral
- spacing.semantic.lg/xl/2xl
- typography.semantic.h4/body/price
- effects.semantic_transitions.normal
- borders.semantic.card

### Infrastructure Services
- SVC-002: Strategy Execution Engine for trade validation
- SVC-005: Real-time Notifications for safety alerts
- EXT-002: Alpaca Trading API for broker-level controls

## Tasks

### Task 1: Core Risk Validation Service
**Type**: backend
**Component**: CREATES: /services/risk_validator
**Design Tokens**: N/A
**Implementation**:
Implement position size, daily loss, and account balance validation as specified in 40-3001-F002-technical.md section 4.3
**Validation**: All safety checks complete within 500ms

### Task 2: Safety Check UI Components
**Type**: frontend
**Component**: USES: data_card, alert_banner from P40-10
**Design Tokens**: colors.semantic.status.success/error, spacing.semantic.xl
**Implementation**:
Build safety validation display as specified in 40-2001-F002-US002-ux-spec.md Screen 1
**Validation**: Visual pass/fail indicators update in real-time

### Task 3: Emergency Stop Mechanism
**Type**: backend
**Component**: CREATES: /services/emergency_stop
**Design Tokens**: N/A
**Implementation**:
Implement immediate strategy shutdown with Redis state management and Alpaca order cancellation
**Validation**: All open orders cancelled within 5 seconds

### Task 4: Risk Confirmation Modal
**Type**: frontend
**Component**: USES: modal, button, form_field from P40-10
**Design Tokens**: colors.semantic.warning, typography.semantic.price_large
**Implementation**:
Build risk acknowledgment interface as specified in 40-2001-F002-US002-ux-spec.md Screen 2
**Validation**: Deploy button only enabled after all confirmations checked